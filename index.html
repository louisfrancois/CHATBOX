<html>
<head>
    <title>Chat with socket.io and node.js</title>
    <style>
        #chat {
            height: 500px;
        }
        #contentWrap {
            display: none;
        }
        #chatWrap {
            float: left;
            border: 1px #000 solid;
        }
    </style>
</head>
<body>
    <div id="nickWrap">
        <p>
          Enter a username:
        </p>
        <p id="setError"></p>
        <form id="setNick">
          <input size="35" id="nickname" autocomplete="off"/>
          <input type="submit" />
        </form>
    </div>

    <div id="contentWrap">
        <div id="chatWrap">
            <div id="chat"></div>
            <form id="send-message">
                <input size="35" id="message" autocomplete="off"/>
                <input type="submit" />
            </form>
        </div>
        <div id="users"></div>
    </div>

    <script src="http://code.jquery.com/jquery-latest.min.js"></script>

    <!-- Socket IO generator -->
    <script src="/socket.io/socket.io.js"></script>

    <!-- Script to allow client to send messages to the server -->
    <script>
        jQuery(function($) {
            // get the socket functionalities
            var socket = io.connect();

            // variables
            var $nickForm = $('#setNick');
            var $nickError = $('#nickError');
            var $nickBox = $('#nickname');
            var $messageForm = $('#send-message');
            var $messageBox = $('#message');
            var $chat = $('#chat');

            // attach an event handler to the nickname form
            $nickForm.submit(function(e) {

              // prevent the form to submit and refresh the page
              e.preventDefault();

              // if nickname valid, show chat
              socket.emit('new user', $messageBox.val(), function(data) {

              });

              // clear nickBox's value
              $nickBox.val('');

            })

            // bind the event handler to the messageForm by attaching
            // a submit handler to the messageForm
            $messageForm.submit(function(e) {

                // prevent the form to submit and refresh the page
                e.preventDefault();

                // send message to the server ('emit' sends an event to the server)
                socket.emit('send message', $messageBox.val());

                // clear messageBox's value
                $messageBox.val('');
            });

            // receive the message on the client side
            socket.on('new message', function(data) {

                // display the message so we can see it
                $chat.append(data + "<br/>");

            });

        });
    </script>
</body>
</html>
